angular.module("Network",[]),angular.module("HomePage",[]),angular.module("Authentication",[]),angular.module("Cameras",[]),angular.module("Camera",[]),angular.module("Users",[]),angular.module("User",[]),angular.module("PiCam",["toastr","ngRoute","ngCookies","ngBootbox","base64","Network","Authentication","HomePage","Cameras","Camera","Users","User"]).config(["$routeProvider","$locationProvider",function(e,o){e.when("/home/",{templateUrl:"modules/HomePage/default.html",controller:"HomePageController"}).when("/cameras",{templateUrl:"modules/Cameras/default.html",controller:"CamerasController"}).when("/cameras/:id",{templateUrl:"modules/Cameras/camera.html",controller:"CameraController"}).when("/cameras/:id/stream",{templateUrl:"modules/Cameras/stream.html",controller:"CameraStreamController"}).when("/cameras/:id/files",{templateUrl:"modules/Cameras/files.html",controller:"CameraFilesController"}).when("/administration/users",{templateUrl:"modules/Users/default.html",controller:"UsersController"}).when("/administration/users/:id",{templateUrl:"modules/Users/user.html",controller:"UserController"}).when("/login",{templateUrl:"modules/Authentication/default.html",controller:"AuthenticationController"}).otherwise({redirectTo:"/home"}),o.html5Mode(!0)}]).run(["$rootScope","$location","HTTPService","breadcrumbs",function(r,o,e,t){r.bodyClass="",r.isLogged=!1,r.SERVER_PATH=SERVER_PATH,r.apikey=null,r.containerClass="",r.breadcrumbs=t,r.logOut=function(){e.logout(function(){r.isLogged=!1,o.path("/login/")})},r.routeContains=function(e){return 0<=o.path().indexOf(e)},r.$on("$locationChangeStart",function(){r.isLogged=e.isLogged(),r.isLogged?(e.initEnv(),e.relogin(function(e,o){o&&r.logOut()})):"/login"===o.path()||r.isLogged||o.path("/login/")})}]).factory("breadcrumbs",["$rootScope","$location",function(e,n){var s=[],o={};return e.$on("$routeChangeSuccess",function(e,o){var r,t,l=n.path().split("/"),a=[];for(l.shift(),r=0;r<l.length;r++)a.push({name:l[r].charAt(0).toUpperCase()+l[r].slice(1),path:(t=r,"/"+l.slice(0,t+1).join("/"))});s=a}),o.getAll=function(){return s},o}]);
angular.module("Authentication").controller("AuthenticationController",["$rootScope","$scope","$location","HTTPService",function(e,n,s,o){"use strict";e.title=TITLEPrefix+"Login",e.bodyClass="signin",e.containerClass="flex-container",n.message=null,n.$on("$destroy",function(){e.bodyClass="",e.containerClass=""}),n.username="",n.password="",n.login=function(){n.message=null,""!==n.username&&""!==n.password?o.login(n.username,n.password,function(){s.path("/cameras/")},function(e){if(null!==e&&void 0!==e.status)switch(e.status){case 401:n.message="Bad login";break;default:n.message="Unknown error"}else n.message="Server downn ?"}):n.message="<strong>Error !</strong> Malformated form"}}]);
angular.module("Camera").controller("CameraController",["$rootScope","$scope","$location","$routeParams","HTTPService","toastr",function(a,t,i,e,r,d){a.title=TITLEPrefix+"Camera",t.Camera={},t.updatedValues={},t.cameraId=null,t.remoteCameras=[],a.containerClass="",t.isLoading=!0,t.$watch("isLoading",function(e){a.containerClass=e?"flex-container":""}),t.$on("$destroy",function(){a.containerClass=""}),t.$watch("[updatedValues.type,updatedValues.definition.uri,updatedValues.definition.scheme,updatedValues.definition.port,updatedValues.definition.apikey]",function(){"Net"===t.updatedValues.type&&void 0!==t.updatedValues.definition.uri&&(Number(t.updatedValues.port)||(t.updatedValues.port=80),r.getAllRemote({scheme:t.updatedValues.definition.scheme,uri:t.updatedValues.definition.uri,port:t.updatedValues.definition.port,apikey:t.updatedValues.definition.apikey,sort:{col:"name",dir:"asc"}},"getRemote",function(e){200===e.status&&(t.remoteCameras=e.data.resources)}))}),t.patchCamera=function(e,a){t.isLoading=!0,r.patch("cameras",e,a,function(e){t.isLoading=!1,200===e.status?(d.success("Action completed"),t.load()):d.error("Can't complete this operation")})},t.updateCamera=function(){t.isLoading=!0,delete t.updatedValues.infos,"add"!==e.id?r.patch("cameras",t.cameraId,t.updatedValues,function(e){t.isLoading=!1,200===e.status?(d.success("Action completed"),t.load()):d.error("Can't complete this operation")}):r.post("cameras",t.updatedValues,function(e){if(t.isLoading=!1,201===e.status)d.success("New camera created"),i.path("/cameras/"+e.data._id);else switch(e.status){case 409:d.error("Can't create new camera because this name is already in use");break;default:d.error("Can't create new camera")}})},t.deleteCamera=function(){t.isLoading=!0,r.delete("cameras",t.cameraId,t.updatedValues,function(e){t.isLoading=!1,200===e.status?(d.success("Camera deleted"),i.path("/cameras/")):d.error("Can't remove this camera")})},t.load=function(){t.isLoading=!0,t.Camera={},"add"!==e.id?(t.cameraId=e.id,r.getOne("cameras",e.id,null,function(e){if(t.isLoading=!1,200===e.status)t.Camera=e.data,t.updatedValues=e.data,delete t.updatedValues._id,a.title=TITLEPrefix+t.Camera.name;else switch(e.status){case 401:d.error("Not authorized");break;case 404:d.error("Camera not found");break;case 500:d.error("Internal server error");break;default:d.error("Can't show this camera")}})):(t.Camera={name:"New camera",type:"Local",definition:{filesDirectory:"/media/freebox",fileIntrustion:"/media/freebox/intrusion.date",motion:{id:0,adminUri:"http://127.0.0.1:8081/0/detection/",streamUri:"http://127.0.0.1:8082/"}}},t.updatedValues=t.Camera,t.isLoading=!1)},t.load()}]);
angular.module("Cameras").controller("CameraFilesController",["$rootScope","$scope","$location","$routeParams","HTTPService",function(a,e,t,i,r){a.title=TITLEPrefix+"Cameras",e.cameraId="",e.Files=[],e.limit=LIMIT,e.currentPage=1,e.pagination=[],e.loadingList=!1,e.load=function(a){e.cameraId=i.id,e.loadingList=!0,e.Files=[],e.currentPage=a,r.getAll("cameras","/"+e.cameraId+"/files/",e.limit,e.currentPage,null,null,function(a){e.loadingList=!1,200===a.status&&(e.pagination=r.returnPagination(a.data.totalRows,a.data.limit,e.currentPage),e.Files=a.data.resources)})},e.load(1)}]);
angular.module("Camera").controller("CameraStreamController",["$rootScope","$scope","$location","$routeParams","HTTPService","toastr",function(r,e,a,t,o,n){r.title=TITLEPrefix+"Camera Stream",e.Camera={},e.cameraId=null,e.load=function(){e.Camera={},e.cameraId=t.id,o.getOne("cameras",t.id,null,function(a){if(e.loadingList=!1,200===a.status)e.Camera=a.data,r.title=TITLEPrefix+e.Camera.name+" stream";else switch(a.status){case 401:n.error("Not authorized");break;case 404:n.error("Camera not found");break;case 500:n.error("Internal server error");break;default:n.error("Can't show this camera")}})},e.load()}]);
angular.module("Cameras").controller("CamerasController",["$rootScope","$scope","$location","HTTPService","toastr",function(a,o,e,n,i){a.title=TITLEPrefix+"Cameras",o.Cameras=[],o.limit=LIMIT,o.currentPage=1,o.pagination=[],o.loadingList=!1,o.patchCamera=function(e,a){var r,t=0,s=o.Cameras.length;for(r=0;r<s;r++)if(o.Cameras[r]._id===e){t=r,o.Cameras[t].isLoading=!0;break}n.patch("cameras",e,a,function(a){200===a.status?(i.success("Action completed"),n.getOne("cameras",e,null,function(a){if(o.Cameras[t].isLoading=!1,200===a.status)o.Cameras[t]=a.data;else switch(a.status){case 401:i.error("Not authorized");break;case 404:i.error("Camera not found, wut ?");break;case 500:i.error("Internal server error while trying reload camera details");break;default:i.error("Can't reload details for this camera")}})):(o.Cameras[t].isLoading=!1,i.error("Can't complete this operation"))})},o.deleteCamera=function(a){n.delete("cameras",a,o.updatedValues,function(a){200===a.status?(o.load(o.currentPage),i.success("Camera deleted")):i.error("Can't remove this camera")})},o.viewCameraDetails=function(a){e.path("/cameras/"+a)},o.load=function(a){o.loadingList=!0,o.Cameras=[],o.currentPage=a,n.getAll("cameras","",o.limit,o.currentPage,null,{id:"name",asc:!0},function(a){o.loadingList=!1,200===a.status&&(o.pagination=n.returnPagination(a.data.totalRows,a.data.limit,o.currentPage),o.Cameras=a.data.resources)})},o.load(1)}]);
angular.module("Network",[]).factory("HTTPService",["$rootScope","$http","$base64","$cookies","$q","$ngBootbox",function(l,r,n,o,c,i){var u={authDatas:o.get("PiCam")||null,userData:null,getAll_cancel:{},getOne_cancel:{},isLogged:function(){return null!==u.authDatas},initEnv:function(){r.defaults.headers.common.Authorization="Basic "+u.authDatas},get:function(e,a,n,t){var i=t||c.defer();return a&&null!==a?a.timeout=i.promise:a={timeout:i.promise},r.get(SERVER_PATH+e,a).then(n,n),i},getRemote:function(e,a,n,t){var i=t||c.defer(),l={method:"GET",url:e,data:null};return a&&null!==a?a.timeout=i.promise:a={timeout:i.promise},l.data=a,r(l).then(n,n),i},patch:function(e,a,n,t){r.patch(SERVER_PATH+e+"/"+a,n).then(t,t)},post:function(e,a,n){r.post(SERVER_PATH+e+"/",a).then(n,n)},delete:function(e,a,n,t){i.confirm("Are you sure to want delete this element ?").then(function(){r.delete(SERVER_PATH+e+"/"+a,n).then(t,t)},function(){console.log("Confirm dismissed!")})},generateAuthorizationHeader:function(e,a){return n.encode(e+":"+a)},login:function(e,a,n,t){var i=this.generateAuthorizationHeader(e,a);r.defaults.headers.common.Authorization="Basic "+i,r.post(APIUri+"authenticate",{username:e,password:a}).then(function(e){var a=e.data;u.authDatas=i,u.userData=a,console.log(a),l.apikey=a.apikey,n&&(o.put("PiCam",i),n())},function(e){t&&t(e)})},relogin:function(a,n){null===u.userData&&r.post(APIUri+"authenticate",null).then(function(e){u.userData=e.data,l.apikey=e.data.apikey,a&&a()},function(e){n&&n(e)})},logout:function(e){u.authDatas=null,o.remove("PiCam"),r.defaults.headers.common.Authorization=null,e()},parseFilters:function(e){var a,n="";for(a in e)Array.isArray(e[a].values)?0<e[a].values.length&&(""!==n&&(n+="&"),n+="q."+e[a].name+"."+e[a].func+"="+e[a].values):"null"!==e[a].values&&""!==e[a].values&&(""!==n&&(n+="&"),n+="q."+e[a].name+"."+e[a].func+"="+e[a].values);return n},getAll:function(e,a,n,t,i,l,r){var o="",c=e+a;u.getAll_cancel[e]&&(u.getAll_cancel[e].resolve(),u.getAll_cancel[e]=void 0),typeof l===Object&&(o=l.id,l.asc||(o="-"+o)),c+="?limit="+n+"&page="+t+"&sort="+o+"&",u.getAll_cancel[e]=u.get(c+u.parseFilters(i),null,r,u.getAll_cancel[e])},getAllRemote:function(e,a,n){var t=e.sort.col;u.getAll_cancel[a]&&(u.getAll_cancel[a].resolve(),u.getAll_cancel[a]=void 0),e.sort.dir||(t="-"+t),u.getAll_cancel[a]=u.getRemote(e.scheme+"://"+e.uri+":"+e.port+"/api/v1/cameras/?apikey="+e.apikey+"&sort="+t,e,n,u.getAll_cancel[a])},getOne:function(e,a,n,t){u.getOne_cancel[e]&&(u.getOne_cancel[e].resolve(),u.getOne_cancel[e]=void 0),u.getOne_cancel[e]=u.get(e+"/"+a+"?"+n,null,t,u.getOne_cancel[e])},returnPagination:function(e,a,n){var t,i,l=Math.ceil(e/(0<a?a:1)),r={list:[],nbPages:l,currentPage:n};for(t=0;t<l;t++)i=t+1,r.list.push({index:i,active:n===i});return r}};return u}]).directive("pagination",function(){return{restrict:"E",template:'<ul class="pagination">   <li ng-class="{disabled: pagination.currentPage === 1}">       <a href="javascript:void(0)" ng-click="pagination.currentPage > 1 && load( pagination.currentPage - 1 )" aria-label="Previous">           <span aria-hidden="true">&laquo;</span>       </a>   </li>   <li class="disabled" ng-repeat-start="p in pagination.list" ng-if="$index > 2 && $index === (pagination.currentPage - 5) ">       <a href="javascript:void(0)">...</a>   </li>   <li ng-class="{active : p.active}" ng-if="$index < 3 || ( $index > (pagination.currentPage - 5) && $index < (pagination.currentPage + 3) ) ||        $index > ( pagination.nbPages - 4 )">       <a href="javascript:void(0)" ng-click="load(p.index)">{{p.index}}</a>   </li>   <li class="disabled" ng-if="$index <= ( pagination.nbPages - 4 ) && $index === (pagination.currentPage + 3) " ng-repeat-end>       <a href="javascript:void(0)">...</a>   </li>   <li ng-class="{disabled: pagination.currentPage === pagination.nbPages}">       <a href="javascript:void(0)" ng-click="pagination.currentPage < pagination.nbPages && load(pagination.currentPage + 1)" aria-label="Next">           <span aria-hidden="true">&raquo;</span>       </a>   </li></ul>'}});
angular.module("HomePage").controller("HomePageController",["$rootScope","$scope","$interval","HTTPService",function(o,t,i,n){"use strict";o.title=TITLEPrefix+"Homepage",t.isLoading=!0,t.Monitoring={},t.lastRefresh=null,t.monitoring=function(){t.isLoading=!0,t.lastRefresh=null,n.getAll("sys","",null,null,null,null,function(o){t.loadingList=!1,200===o.status&&(t.isLoading=!1,t.Monitoring=o.data,t.Monitoring.memory.usage=Math.round(100*t.Monitoring.memory.used/t.Monitoring.memory.total),t.Monitoring.disks.root.usage=Math.round(100-100*t.Monitoring.disks.root.free/t.Monitoring.disks.root.total),t.Monitoring.disks.boot.usage=Math.round(100-100*t.Monitoring.disks.boot.free/t.Monitoring.disks.boot.total),t.lastRefresh=moment().format("DD/MM/YYYY H:m:s"))})},t.monitoring()}]).directive("sysProgressBar",function(){return{restrict:"E",scope:{value:"=value",title:"@"},templateUrl:"templates/progress-bar.html"}});
angular.module("User").controller("UserController",["$rootScope","$scope","$location","$routeParams","HTTPService","toastr","$ngBootbox",function(s,t,r,a,o,u,n){s.title=TITLEPrefix+"User",t.User={},t.updatedValues={},t.userId=null,t.patchUser=function(e,s){o.patch("users",e,s,function(e){200===e.status?(u.success("Action completed"),t.load()):u.error("Can't complete this operation")})},t.updateUser=function(){var e=!1,s=function(){"add"!==a.id?o.patch("users",t.userId,t.updatedValues,function(e){200===e.status?(u.success("Action completed"),t.load()):u.error("Can't complete this operation")}):o.post("users",t.updatedValues,function(e){if(201===e.status)u.success("New user created"),r.path("/administration/users/"+e.data._id);else switch(e.status){case 409:u.error("Can't create new user because this email or this apikey is already in use");break;default:u.error("Can't create new user")}})};delete t.updatedValues.infos,"add"===a.id&&0===t.updatedValues.password.length&&(e=!0),!1===e?s():n.confirm("No password set, are you sure?").then(function(){s()},function(){console.log("Confirm dismissed!")})},t.deleteUser=function(){o.delete("users",t.userId,t.updatedValues,function(e){200===e.status?(u.success("User deleted"),r.path("/administration/users/")):u.error("Can't remove this user")})},t.generateApiKey=function(){var e="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%&*-_=+";for(_i=0;_i<32;_i++)e+=s.charAt(Math.floor(Math.random()*s.length));t.updatedValues.apikey=e},t.load=function(){t.User={},"add"!==a.id?(t.userId=a.id,o.getOne("users",a.id,null,function(e){if(t.loadingList=!1,200===e.status)t.User=e.data,t.updatedValues=e.data,delete t.updatedValues._id,s.title=TITLEPrefix+t.User.first_name+t.User.last_name;else switch(e.status){case 401:u.error("Not authorized");break;case 404:u.error("User not found");break;case 500:u.error("Internal server error");break;default:u.error("Can't show this user")}})):(t.User={},t.updatedValues={},t.generateApiKey(),t.showEditableValues=!0)},t.load()}]);
angular.module("Users").controller("UsersController",["$rootScope","$scope","$location","HTTPService","toastr",function(t,a,e,i,r){t.title=TITLEPrefix+"Users",a.Users=[],a.limit=LIMIT,a.currentPage=1,a.pagination=[],a.loadingList=!1,a.viewUserDetails=function(t){e.path("/administration/users/"+t)},a.load=function(t){a.loadingList=!0,a.Users=[],a.currentPage=t,i.getAll("users","",a.limit,a.currentPage,null,{id:"name",asc:!0},function(t){a.loadingList=!1,200===t.status&&(a.pagination=i.returnPagination(t.data.totalRows,t.data.limit,a.currentPage),a.Users=t.data.resources)})},a.load(1)}]);