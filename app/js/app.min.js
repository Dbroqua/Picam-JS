angular.module("Network",[]),angular.module("HomePage",[]),angular.module("Authentication",[]),angular.module("Cameras",[]),angular.module("Camera",[]),angular.module("Users",[]),angular.module("User",[]),angular.module("PiCam",["toastr","ngRoute","ngCookies","ngBootbox","base64","Network","Authentication","HomePage","Cameras","Camera","Users","User"]).config(["$routeProvider","$locationProvider",function(e,o){e.when("/home/",{templateUrl:"modules/HomePage/default.html",controller:"HomePageController"}).when("/cameras",{templateUrl:"modules/Cameras/default.html",controller:"CamerasController"}).when("/cameras/:id",{templateUrl:"modules/Cameras/camera.html",controller:"CameraController"}).when("/cameras/:id/stream",{templateUrl:"modules/Cameras/stream.html",controller:"CameraStreamController"}).when("/cameras/:id/files",{templateUrl:"modules/Cameras/files.html",controller:"CameraFilesController"}).when("/administration/users",{templateUrl:"modules/Users/default.html",controller:"UsersController"}).when("/administration/users/:id",{templateUrl:"modules/Users/user.html",controller:"UserController"}).when("/login",{templateUrl:"modules/Authentication/default.html",controller:"AuthenticationController"}).otherwise({redirectTo:"/home"}),o.html5Mode(!0)}]).run(["$rootScope","$location","HTTPService","breadcrumbs",function(t,o,e,r){t.bodyClass="",t.isLogged=!1,t.SERVER_PATH=SERVER_PATH,t.apikey=null,t.containerClass="",t.breadcrumbs=r,t.logOut=function(){e.logout(function(){t.isLogged=!1,o.path("/login/")})},t.routeContains=function(e){return 0<=o.path().indexOf(e)},t.$on("$locationChangeStart",function(){t.isLogged=e.isLogged(),t.isLogged?(e.initEnv(),e.relogin(function(e,o){o&&t.logOut()})):"/login"===o.path()||t.isLogged||o.path("/login/")})}]).factory("breadcrumbs",["$rootScope","$location",function(e,n){var m={items:[]};return e.$on("$routeChangeSuccess",function(e,o){var t,r,l=n.path().split("/"),a=[];for(l.shift(),t=0;t<l.length;t++)a.push({name:l[t].charAt(0).toUpperCase()+l[t].slice(1),path:(r=t,"/"+l.slice(0,r+1).join("/"))});"/home"!=a[0].path&&a.unshift({name:"Home",path:"/home"}),m.items=a}),m}]).directive("breadCrumb",function(){return console.log("called!"),{scope:{items:"=items"},templateUrl:"templates/breadcrumb.html"}});
angular.module("Authentication").controller("AuthenticationController",["$rootScope","$scope","$location","HTTPService",function(e,n,s,o){"use strict";e.title=TITLEPrefix+"Login",e.bodyClass="text-center signin",e.containerClass="flex-container",n.message=null,n.$on("$destroy",function(){e.bodyClass="",e.containerClass=""}),n.username="",n.password="",n.login=function(){n.message=null,""!==n.username&&""!==n.password?o.login(n.username,n.password,function(){s.path("/cameras/")},function(e){if(null!==e&&void 0!==e.status)switch(e.status){case 401:n.message="Bad login";break;default:n.message="Unknown error"}else n.message="Server downn ?"}):n.message="<strong>Error !</strong> Malformated form"}}]);
angular.module("Camera").controller("CameraController",["$rootScope","$scope","$location","$routeParams","HTTPService","toastr",function(a,t,i,e,r,s){a.title=TITLEPrefix+"Camera",t.Camera={},t.updatedValues={},t.cameraId=null,t.remoteCameras=[],a.containerClass="",t.isLoading=!0,t.$watch("isLoading",function(e){a.containerClass=e?"flex-container":""}),t.$on("$destroy",function(){a.containerClass=""}),t.$watch("[updatedValues.type,updatedValues.definition.uri,updatedValues.definition.scheme,updatedValues.definition.port,updatedValues.definition.apikey]",function(){"Net"===t.updatedValues.type&&void 0!==t.updatedValues.definition.uri&&(Number(t.updatedValues.port)||(t.updatedValues.port=80),r.getAllRemote({scheme:t.updatedValues.definition.scheme,uri:t.updatedValues.definition.uri,port:t.updatedValues.definition.port,apikey:t.updatedValues.definition.apikey,sort:{col:"name",dir:"asc"}},"getRemote",function(e){200===e.status&&(t.remoteCameras=e.data.resources)}))}),t.patchCamera=function(e,a){t.isLoading=!0,r.patch("cameras",e,a,function(e){t.isLoading=!1,200===e.status?(s.success("Action completed"),t.load()):s.error("Can't complete this operation")})},t.updateCamera=function(){t.isLoading=!0,delete t.updatedValues.infos,"add"!==e.id?r.patch("cameras",t.cameraId,t.updatedValues,function(e){t.isLoading=!1,200===e.status?(s.success("Action completed"),t.load()):s.error("Can't complete this operation")}):r.post("cameras",t.updatedValues,function(e){if(t.isLoading=!1,201===e.status)s.success("New camera created"),i.path("/cameras/"+e.data._id);else switch(e.status){case 409:s.error("Can't create new camera because this name is already in use");break;default:s.error("Can't create new camera")}})},t.deleteCamera=function(){t.isLoading=!0,r.delete("cameras",t.cameraId,function(e){t.isLoading=!1,200===e.status?(s.success("Camera deleted"),i.path("/cameras/")):s.error("Can't remove this camera")})},t.load=function(){t.isLoading=!0,t.Camera={},"add"!==e.id?(t.cameraId=e.id,r.getOne("cameras",e.id,null,function(e){if(t.isLoading=!1,200===e.status)t.Camera=e.data,t.updatedValues=e.data,delete t.updatedValues._id,a.title=TITLEPrefix+t.Camera.name;else switch(e.status){case 401:s.error("Not authorized");break;case 404:s.error("Camera not found");break;case 500:s.error("Internal server error");break;default:s.error("Can't show this camera")}})):(t.Camera={name:"New camera",type:"Local",definition:{filesDirectory:"/media/freebox",fileIntrustion:"/media/freebox/intrusion.date",motion:{id:0,adminUri:"http://127.0.0.1:8081/0/detection/",streamUri:"http://127.0.0.1:8082/"}}},t.updatedValues=t.Camera,t.isLoading=!1)},t.load()}]);
angular.module("Cameras").controller("CameraFilesController",["$rootScope","$scope","$location","$routeParams","HTTPService",function(a,e,t,i,r){a.title=TITLEPrefix+"Cameras",e.cameraId="",e.Files=[],e.limit=LIMIT,e.currentPage=1,e.pagination=[],e.loadingList=!1,e.load=function(a){e.cameraId=i.id,e.loadingList=!0,e.Files=[],e.currentPage=a,r.getAll("cameras","/"+e.cameraId+"/files/",e.limit,e.currentPage,null,null,function(a){e.loadingList=!1,200===a.status&&(e.pagination=r.returnPagination(a.data.totalRows,a.data.limit,e.currentPage),e.Files=a.data.resources)})},e.load(1)}]);
angular.module("Camera").controller("CameraStreamController",["$rootScope","$scope","$location","$routeParams","HTTPService","toastr",function(r,e,a,t,o,n){r.title=TITLEPrefix+"Camera Stream",e.Camera={},e.cameraId=null,e.load=function(){e.Camera={},e.cameraId=t.id,o.getOne("cameras",t.id,null,function(a){if(e.loadingList=!1,200===a.status)e.Camera=a.data,r.title=TITLEPrefix+e.Camera.name+" stream";else switch(a.status){case 401:n.error("Not authorized");break;case 404:n.error("Camera not found");break;case 500:n.error("Internal server error");break;default:n.error("Can't show this camera")}})},e.load()}]);
angular.module("Cameras").controller("CamerasController",["$rootScope","$scope","$location","HTTPService","toastr",function(a,s,e,n,i){a.title=TITLEPrefix+"Cameras",s.Cameras=[],s.limit=LIMIT,s.currentPage=1,s.pagination=[],s.loadingList=!1,s.patchCamera=function(e,a){var r,t=0,o=s.Cameras.length;for(r=0;r<o;r++)if(s.Cameras[r]._id===e){t=r,s.Cameras[t].isLoading=!0;break}n.patch("cameras",e,a,function(a){200===a.status?(i.success("Action completed"),n.getOne("cameras",e,null,function(a){if(s.Cameras[t].isLoading=!1,200===a.status)s.Cameras[t]=a.data;else switch(a.status){case 401:i.error("Not authorized");break;case 404:i.error("Camera not found, wut ?");break;case 500:i.error("Internal server error while trying reload camera details");break;default:i.error("Can't reload details for this camera")}})):(s.Cameras[t].isLoading=!1,i.error("Can't complete this operation"))})},s.deleteCamera=function(a){n.delete("cameras",a,function(a){200===a.status?(s.load(s.currentPage),i.success("Camera deleted")):i.error("Can't remove this camera")})},s.viewCameraDetails=function(a){e.path("/cameras/"+a)},s.load=function(a){s.loadingList=!0,s.Cameras=[],s.currentPage=a,n.getAll("cameras","",s.limit,s.currentPage,null,{id:"name",asc:!0},function(a){s.loadingList=!1,200===a.status&&(s.pagination=n.returnPagination(a.data.totalRows,a.data.limit,s.currentPage),s.Cameras=a.data.resources)})},s.load(1)}]);
angular.module("Network",[]).factory("HTTPService",["$rootScope","$http","$base64","$cookies","$q","$ngBootbox",function(o,i,n,r,c,u){var s={authDatas:r.get("PiCam")||null,userData:null,getAll_cancel:{},getOne_cancel:{},isLogged:function(){return null!==s.authDatas},initEnv:function(){i.defaults.headers.common.Authorization="Basic "+s.authDatas},get:function(e,t,n,a){var l=a||c.defer();return t&&null!==t?t.timeout=l.promise:t={timeout:l.promise},i.get(SERVER_PATH+e,t).then(n,n),l},getRemote:function(e,t,n,a){var l=a||c.defer(),o={method:"GET",url:e,data:null};return t&&null!==t?t.timeout=l.promise:t={timeout:l.promise},o.data=t,i(o).then(n,n),l},patch:function(e,t,n,a){i.patch(SERVER_PATH+e+"/"+t,n).then(a,a)},post:function(e,t,n){i.post(SERVER_PATH+e+"/",t).then(n,n)},delete:function(e,t,n,a){var l=n;void 0===a&&(a=n,l="Are you sure to want delete this element ?"),u.confirm(l).then(function(){i.delete(SERVER_PATH+e+"/"+t).then(a,a)},function(){console.log("Confirm dismissed!")})},generateAuthorizationHeader:function(e,t){return n.encode(e+":"+t)},login:function(e,t,n,a){var l=this.generateAuthorizationHeader(e,t);i.defaults.headers.common.Authorization="Basic "+l,i.post(APIUri+"authenticate",{username:e,password:t}).then(function(e){var t=e.data;s.authDatas=l,s.userData=t,console.log(t),o.apikey=t.apikey,n&&(r.put("PiCam",l),n())},function(e){a&&a(e)})},relogin:function(t,n){null===s.userData&&i.post(APIUri+"authenticate",null).then(function(e){s.userData=e.data,o.apikey=e.data.apikey,t&&t()},function(e){n&&n(e)})},logout:function(e){s.authDatas=null,r.remove("PiCam"),i.defaults.headers.common.Authorization=null,e()},parseFilters:function(e){var t,n="";for(t in e)Array.isArray(e[t].values)?0<e[t].values.length&&(""!==n&&(n+="&"),n+="q."+e[t].name+"."+e[t].func+"="+e[t].values):"null"!==e[t].values&&""!==e[t].values&&(""!==n&&(n+="&"),n+="q."+e[t].name+"."+e[t].func+"="+e[t].values);return n},getAll:function(e,t,n,a,l,o,i){var r="",c=e+t;s.getAll_cancel[e]&&(s.getAll_cancel[e].resolve(),s.getAll_cancel[e]=void 0),typeof o===Object&&(r=o.id,o.asc||(r="-"+r)),c+="?limit="+n+"&page="+a+"&sort="+r+"&",s.getAll_cancel[e]=s.get(c+s.parseFilters(l),null,i,s.getAll_cancel[e])},getAllRemote:function(e,t,n){var a=e.sort.col;s.getAll_cancel[t]&&(s.getAll_cancel[t].resolve(),s.getAll_cancel[t]=void 0),e.sort.dir||(a="-"+a),s.getAll_cancel[t]=s.getRemote(e.scheme+"://"+e.uri+":"+e.port+"/api/v1/cameras/?apikey="+e.apikey+"&sort="+a,e,n,s.getAll_cancel[t])},getOne:function(e,t,n,a){s.getOne_cancel[e]&&(s.getOne_cancel[e].resolve(),s.getOne_cancel[e]=void 0),s.getOne_cancel[e]=s.get(e+"/"+t+"?"+n,null,a,s.getOne_cancel[e])},returnPagination:function(e,t,n){var a,l,o=Math.ceil(e/(0<t?t:1)),i={list:[],nbPages:o,currentPage:n};for(a=0;a<o;a++)l=a+1,i.list.push({index:l,active:n===l});return i}};return s}]).directive("pagination",function(){return{restrict:"E",scope:{pagination:"=pages"},templateUrl:"templates/pagination.html"}});
angular.module("HomePage").controller("HomePageController",["$rootScope","$scope","$interval","toastr","HTTPService",function(o,t,i,r,e){"use strict";o.title=TITLEPrefix+"Homepage",o.bodyClass="monitoring",t.isLoading=!0,t.Monitoring={},t.lastRefresh=null,t.monitoring=function(){t.isLoading=!0,t.lastRefresh=null,e.getAll("sys","",null,null,null,null,function(o){t.loadingList=!1,200===o.status&&(t.isLoading=!1,t.Monitoring=o.data,t.Monitoring.memory.usage=Math.round(100*t.Monitoring.memory.used/t.Monitoring.memory.total),t.Monitoring.disks.root.usage=Math.round(100-100*t.Monitoring.disks.root.free/t.Monitoring.disks.root.total),t.Monitoring.disks.boot.usage=Math.round(100-100*t.Monitoring.disks.boot.free/t.Monitoring.disks.boot.total),t.lastRefresh=moment().format("DD/MM/YYYY H:m:s"))})},t.reboot=function(){e.delete("sys/uptime","","Are you sure you want to reboot this Pi?",function(o){202===o.status?r.info("This Pi will reboot in few seconds"):r.error("Error when trying to restart this Pi")})},$('[data-toggle="tooltip"]').tooltip(),t.monitoring()}]).directive("sysProgressBar",function(){return{restrict:"E",scope:{value:"=value",title:"@"},templateUrl:"templates/progress-bar.html"}});
angular.module("User").controller("UserController",["$rootScope","$scope","$location","$routeParams","HTTPService","toastr","$ngBootbox",function(s,t,r,a,o,u,n){s.title=TITLEPrefix+"User",t.User={},t.updatedValues={},t.userId=null,t.patchUser=function(e,s){o.patch("users",e,s,function(e){200===e.status?(u.success("Action completed"),t.load()):u.error("Can't complete this operation")})},t.updateUser=function(){var e=!1,s=function(){"add"!==a.id?o.patch("users",t.userId,t.updatedValues,function(e){200===e.status?(u.success("Action completed"),t.load()):u.error("Can't complete this operation")}):o.post("users",t.updatedValues,function(e){if(201===e.status)u.success("New user created"),r.path("/administration/users/"+e.data._id);else switch(e.status){case 409:u.error("Can't create new user because this email or this apikey is already in use");break;default:u.error("Can't create new user")}})};delete t.updatedValues.infos,"add"===a.id&&0===t.updatedValues.password.length&&(e=!0),!1===e?s():n.confirm("No password set, are you sure?").then(function(){s()},function(){console.log("Confirm dismissed!")})},t.deleteUser=function(){o.delete("users",t.userId,function(e){200===e.status?(u.success("User deleted"),r.path("/administration/users/")):u.error("Can't remove this user")})},t.generateApiKey=function(){var e="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%&*-_=+";for(_i=0;_i<32;_i++)e+=s.charAt(Math.floor(Math.random()*s.length));t.updatedValues.apikey=e},t.load=function(){t.User={},"add"!==a.id?(t.userId=a.id,o.getOne("users",a.id,null,function(e){if(t.loadingList=!1,200===e.status)t.User=e.data,t.updatedValues=e.data,delete t.updatedValues._id,s.title=TITLEPrefix+t.User.first_name+t.User.last_name;else switch(e.status){case 401:u.error("Not authorized");break;case 404:u.error("User not found");break;case 500:u.error("Internal server error");break;default:u.error("Can't show this user")}})):(t.User={},t.updatedValues={},t.generateApiKey(),t.showEditableValues=!0)},t.load()}]);
angular.module("Users").controller("UsersController",["$rootScope","$scope","$location","HTTPService","toastr",function(t,a,e,i,r){t.title=TITLEPrefix+"Users",a.Users=[],a.limit=LIMIT,a.currentPage=1,a.pagination=[],a.loadingList=!1,a.viewUserDetails=function(t){e.path("/administration/users/"+t)},a.load=function(t){a.loadingList=!0,a.Users=[],a.currentPage=t,i.getAll("users","",a.limit,a.currentPage,null,{id:"name",asc:!0},function(t){a.loadingList=!1,200===t.status&&(a.pagination=i.returnPagination(t.data.totalRows,t.data.limit,a.currentPage),a.Users=t.data.resources)})},a.load(1)}]);